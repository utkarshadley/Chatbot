<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KISAN COLLEGE AI Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxXzKzL3N7D5D9R7l1z6E11116R4D5D9R7D9R6D6lG9R7Q8lG8R8lG8R9R8lG9R7R8lG9R7Q8R9Q"
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@19.4/dist/leaflet.js"
      integrity="sha256-2eA263w3R9Q5z1Q5e1Q3Q5z1R8L8w8W9Q4Q5z1Q5e1Q3R8L9W5Q4Q5z1R8L9W5Q4Q5z1R8L9W5Q4Q"
      crossorigin=""
    ></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

      * {
        box-sizing: border-box;
      }

      :root {
        --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      /* Light mode colors */
      .light-theme {
        --chat-bg: white;
        --messages-bg: #f8f9fa;
        --input-bg: #f8f9fa;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --bot-message-bg: #e5e7eb;
        --bot-message-text: #1f2937;
        --user-message-bg: #3b82f6;
        --user-message-text: white;
        --button-bg: #f3f4f6;
        --button-hover-bg: #e5e7eb;
        --shadow-color: rgba(0, 0, 0, 0.1);
      }

      /* Dark mode colors */
      .dark-theme {
        --bg-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        --chat-bg: #1f2937;
        --messages-bg: #111827;
        --input-bg: #1f2937;
        --text-primary: #ffffff;
        --text-secondary: #9ca3af;
        --border-color: #4b5563;
        --bot-message-bg: #374151;
        --bot-message-text: #e5e7eb;
        --user-message-bg: #3b82f6;
        --user-message-text: white;
        --button-bg: #4b5563;
        --button-hover-bg: #6b7280;
        --shadow-color: rgba(0, 0, 0, 0.4);
      }

      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-gradient);
        font-family: "Inter", sans-serif;
        transition: background 0.3s ease;
      }

      .chat-container {
        width: 100%;
        max-width: 450px;
        min-height: 600px;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        background: var(--chat-bg);
        border-radius: 20px;
        box-shadow: 0 20px 40px var(--shadow-color);
        overflow: hidden;
        margin: 1rem;
        position: relative;
        transition: all 0.3s ease;
      }

      .messages-container {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem;
        padding-top: 5rem;
        background-color: var(--messages-bg);
        scroll-behavior: smooth;
        transition: background-color 0.3s ease;
      }

      .typing-dots {
        display: flex;
        gap: 0.25rem;
      }

      .typing-dot {
        width: 0.5rem;
        height: 0.5rem;
        background-color: var(--text-secondary);
        border-radius: 50%;
        animation: bounce 1.4s infinite ease-in-out;
      }

      .typing-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .typing-dot:nth-child(2) {
        animation-delay: -0.16s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      .bot-avatar {
        width: 2.5rem;
        height: 2.5rem;
        background-color: black;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .bot-eyes {
        width: 1.5rem;
        height: 1.5rem;
        background-color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.125rem;
      }

      .bot-eye {
        width: 0.375rem;
        height: 0.375rem;
        background-color: black;
        border-radius: 50%;
      }

      .user-avatar {
        width: 2.5rem;
        height: 2.5rem;
        background-color: #7c3aed;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 500;
        font-size: 0.875rem;
        flex-shrink: 0;
      }

      .messages-container::-webkit-scrollbar {
        width: 4px;
      }

      .messages-container::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      .messages-container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 2px;
      }

      .media-button {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        border: none;
        cursor: pointer;
        background: var(--button-bg);
        color: var(--text-secondary);
      }

      .media-button:hover {
        transform: scale(1.05);
        background: var(--button-hover-bg);
      }

      .media-button.active {
        background-color: #ef4444;
        color: white;
      }

      .media-button.active:hover {
        background-color: #dc2626;
      }

      /* Map Container Style */
      #map-container {
        height: 400px;
        width: 100%;
        display: none;
        margin-top: 10px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .message-bubble {
        max-width: 85%;
        word-wrap: break-word;
        transition: background-color 0.3s ease, color 0.3s ease;
        line-height: 1.5;
        font-size: 0.875rem; /* text-sm */
      }

      .bot-message {
        background-color: var(--bot-message-bg) !important;
        color: var(--bot-message-text) !important;
        border-radius: 1.5rem; /* rounded-3xl */
        padding: 0.75rem 1rem; /* px-4 py-3 */
      }

      .user-message {
        background-color: var(--user-message-bg) !important;
        color: var(--user-message-text) !important;
        border-radius: 1.5rem; /* rounded-3xl */
        padding: 0.75rem 1rem; /* px-4 py-3 */
      }

      .input-area {
        background-color: var(--input-bg);
        transition: background-color 0.3s ease;
      }

      .message-input {
        background-color: var(--chat-bg);
        color: var(--text-primary);
        border-color: var(--border-color);
        transition: background-color 0.3s ease, color 0.3s ease,
          border-color 0.3s ease;
      }

      .message-input::placeholder {
        color: var(--text-secondary);
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .chat-container {
          max-width: 95vw;
          min-height: 80vh;
          max-height: 90vh;
          margin: 0.5rem;
          border-radius: 15px;
        }

        .messages-container {
          padding: 1rem;
          padding-top: 3.5rem;
        }

        .bot-avatar,
        .user-avatar {
          width: 2rem;
          height: 2rem;
        }

        .bot-eyes {
          width: 1.2rem;
          height: 1.2rem;
        }

        .bot-eye {
          width: 0.3rem;
          height: 0.3rem;
        }

        .media-button {
          width: 2rem;
          height: 2rem;
        }
      }

      @media (max-width: 480px) {
        .chat-container {
          max-width: 100vw;
          min-height: 100vh;
          max-height: 100vh;
          margin: 0;
          border-radius: 0;
        }

        .messages-container {
          padding: 0.75rem;
          padding-top: 3rem;
        }

        .message-bubble {
          max-width: 90%;
        }

        body {
          background: var(--bg-gradient);
        }
      }
    </style>
  </head>
  <body class="light-theme">
    <div class="chat-container">
      <div
        class="flex items-center justify-between p-4 bg-white/50 backdrop-blur-md rounded-t-2xl absolute top-0 left-0 right-0 z-10 border-b border-gray-200 dark:bg-gray-800/50 dark:border-gray-700"
      >
        <h1 class="text-xl font-bold text-gray-800 dark:text-gray-100">
          Kisan College Chatbot
        </h1>
        <button
          class="media-button"
          id="themeToggle"
          title="Toggle dark/light mode"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            ></path>
          </svg>
        </button>
      </div>

      <div class="messages-container" id="messagesContainer">
        <div class="flex justify-start mb-4">
          <div class="flex items-start space-x-3 max-w-xs">
            <div class="bot-avatar">
              <div class="bot-eyes">
                <div class="bot-eye"></div>
                <div class="bot-eye"></div>
              </div>
            </div>
            <div
              class="bg-gray-200 text-gray-800 rounded-3xl px-4 py-3 message-bubble bot-message"
            >
              <p class="text-sm leading-relaxed">
                Hello, I am a student's helper of Kisan College. How Can I help
                you?
              </p>
            </div>
          </div>
        </div>
        <div id="map-container"></div>
      </div>

      <div class="p-4 input-area">
        <div class="flex items-center space-x-3">
          <button id="cameraButton" class="media-button" title="Take photo">
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"
              ></path>
            </svg>
          </button>

          <button
            id="microphoneButton"
            class="media-button"
            title="Voice message"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
              ></path>
            </svg>
          </button>

          <div class="flex-1 relative">
            <input
              type="text"
              id="messageInput"
              placeholder="Type your message..."
              class="w-full px-4 py-3 text-sm message-input rounded-full border focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
            />
          </div>
          <button
            id="sendButton"
            class="w-10 h-10 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-full flex items-center justify-center transition-colors duration-200"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
              ></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <script>
      const messagesContainer = document.getElementById("messagesContainer");
      const messageInput = document.getElementById("messageInput");
      const sendButton = document.getElementById("sendButton");
      const microphoneButton = document.getElementById("microphoneButton");
      const cameraButton = document.getElementById("cameraButton");
      const themeToggle = document.getElementById("themeToggle");

      let isTyping = false;
      let isRecording = false;
      let recognition = null;
      let selectedImage = null;
      let selectedImageData = null;
      let mapInstance = null;
      let mapContainer = null;
      let currentTheme = "light";

      const syllabuses = {
        ug_syllabus: [
          {
            name: "B.Sc. (Hons.) Mathematics",
            url: "https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-MAT_compressed.pdf",
          },
          {
            name: "B.A. (Hons.) Hindi",
            url: "https://ppup.ac.in/download/UG%20SYLLABUS-%20Hindi.pdf",
          },
          {
            name: "B.Com. (Hons.) Accounting",
            url: "https://ppup.ac.in/download/syllabus/FYUG-B.Com-in-Accounting-and-Finance.pdf",
          },
          {
            name: "B.Sc. (Hons.) Physics",
            url: "https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-PHY_compressed.pdf",
          },
          {
            name: "B.Sc. (Hons.) Chemistry",
            url: "https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-CHE_compressed.pdf",
          },
          {
            name: "Computer Science Department",
            urls: [
              {
                name: "BSc. IT Syllabus",
                url: "https://drive.google.com/file/d/1gQRjbq-QhVVKXY9RKsUnPApNL3bS49uo/view?usp=sharing",
              },
              {
                name: "BCA Syllabus",
                url: "https://www.ibcpatna.in/BCA_Syllabus.pdf",
              },
            ],
          },
        ],
        pg_syllabus: [
          {
            name: "M.Sc. (Hons.) Geography",
            url: "https://ppup.ac.in/download/Phd%20PAT-2025%20syllabus/P.G.%20Geography.pdf",
          },
          {
            name: "M.Sc. (Hons.) History",
            url: "https://ppup.ac.in/download/Phd%20PAT-2025%20syllabus/P.G.%20History.pdf",
          },
          {
            name: "M.A. (Hons.) Psychology",
            url: "https://ppup.ac.in/download/Phd%20PAT-2025%20syllabus/P.G.%20Psychology.pdf",
          },
          {
            name: "M.Com. (Hons.) Accounting",
            url: "https://ppup.ac.in/download/syllabus/FYUG-B.Com-in-Accounting-and-Finance.pdf",
          },
          {
            name: "M.Sc. (Hons.) Zoology",
            url: "https://ppup.ac.in/download/public_html/download/UG-PG-Syllabus/P.G.%20Zoology.pdf",
          },
          {
            name: "Computer Science Department",
            urls: [
              {
                name: "MCA Syllabus",
                url: "https://www.jdwcpatna.ac.in/download/mcasyllabus2020.pdf",
              },
              {
                name: "M.Sc. IT Syllabus",
                url: "https://archive.mu.ac.in/myweb_test/MSC-IT-Syllabus.pdf",
              },
            ],
          },
        ],
      };

      // --- Theme Toggle Logic ---
      function toggleTheme() {
        const htmlElement = document.documentElement;
        const themeIcon = themeToggle.querySelector("svg path");

        if (htmlElement.classList.contains("dark")) {
          htmlElement.classList.remove("dark");
          document.body.classList.remove("dark-theme");
          document.body.classList.add("light-theme");
          currentTheme = "light";
          themeIcon.setAttribute(
            "d",
            "M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
          );
        } else {
          htmlElement.classList.add("dark");
          document.body.classList.remove("light-theme");
          document.body.classList.add("dark-theme");
          currentTheme = "dark";
          themeIcon.setAttribute(
            "d",
            "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
          );
        }
      }

      function loadInitialTheme() {
        if (
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
        ) {
          toggleTheme();
        } else {
          document.body.classList.add("light-theme");
        }
      }

      // --- Chat Message Functions ---
      function scrollToBottom() {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function createBotMessage(content, hasTyping = false) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "flex justify-start mb-4";

        let messageContent = "";
        if (hasTyping) {
          messageContent =
            '<div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
        } else {
          const textWithBreaks = content.replace(/\n/g, "<br>");
          messageContent = `<p class="text-sm leading-relaxed">${textWithBreaks}</p>`;
        }

        messageDiv.innerHTML = `
                <div class="flex items-start space-x-3 max-w-xs md:max-w-sm">
                    <div class="bot-avatar">
                        <div class="bot-eyes">
                            <div class="bot-eye"></div>
                            <div class="bot-eye"></div>
                        </div>
                    </div>
                    <div class="bg-gray-200 text-gray-800 rounded-3xl px-4 py-3 message-bubble bot-message">
                        ${messageContent}
                    </div>
                </div>`;
        return messageDiv;
      }

      function createUserMessage(content) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "flex justify-end mb-4";

        messageDiv.innerHTML = `
                <div class="flex items-start space-x-3 max-w-xs md:max-w-sm flex-row-reverse space-x-reverse">
                    <div class="user-avatar">U</div>
                    <div class="rounded-3xl px-4 py-3 message-bubble user-message">
                        <p class="text-sm leading-relaxed">${content}</p>
                    </div>
                </div>`;
        return messageDiv;
      }

      // --- New function to handle UG Syllabus query ---
      function handleUgSyllabusQuery() {
        let responseHtml = "UG Courses ke syllabus yahan hain:<br><br>";
        syllabuses.ug_syllabus.forEach((syllabus) => {
          if (syllabus.urls) {
            responseHtml += `**${syllabus.name}**: <br>`;
            syllabus.urls.forEach((link) => {
              responseHtml += `<a href='${link.url}' target='_blank' style='color:#3b82f6; text-decoration: underline;'>${link.name}</a><br>`;
            });
            responseHtml += "<br>";
          } else {
            responseHtml += `**${syllabus.name}**: <a href='${syllabus.url}' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a><br><br>`;
          }
        });
        const botMessage = createBotMessage(responseHtml);
        messagesContainer.appendChild(botMessage);
      }

      // --- New function for PG Syllabus ---
      function handlePgSyllabusQuery() {
        let responseHtml = "PG Courses ke syllabus yahan hain:<br><br>";
        syllabuses.pg_syllabus.forEach((syllabus) => {
          if (syllabus.urls) {
            responseHtml += `**${syllabus.name}**: <br>`;
            syllabus.urls.forEach((link) => {
              responseHtml += `<a href='${link.url}' target='_blank' style='color:#3b82f6; text-decoration: underline;'>${link.name}</a><br>`;
            });
            responseHtml += "<br>";
          } else {
            responseHtml += `**${syllabus.name}**: <a href='${syllabus.url}' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a><br><br>`;
          }
        });
        const botMessage = createBotMessage(responseHtml);
        messagesContainer.appendChild(botMessage);
      }

      // --- Send Message Logic ---
      async function sendMessage() {
        const message = messageInput.value.trim().toLowerCase();
        if ((!message && !selectedImage) || isTyping) return;

        messagesContainer.appendChild(
          createUserMessage(messageInput.value.trim())
        );
        messageInput.value = "";
        clearImagePreview();
        hideMap();
        scrollToBottom();

        isTyping = true;
        sendButton.disabled = true;
        const typingMessage = createBotMessage("", true);
        messagesContainer.appendChild(typingMessage);
        scrollToBottom();

        let botResponseText = "";
        let coords = null;

        // Tier 1: General Department/Course query
        const departmentKeywords = [
          "department",
          "departments",
          "course",
          "courses",
          "stream",
          "streams",
          "subject",
          "subjects",
        ];
        const isDepartmentQuery = departmentKeywords.some((keyword) =>
          message.includes(keyword)
        );

        // Tier 2: Specific Department list
        const vocationalKeywords = [
          "vocational",
          "professional",
          "bba",
          "bca",
          "blis",
          "bsc it",
        ];
        const humanitiesKeywords = [
          "humanities",
          "english",
          "hindi",
          "urdu",
          "pali",
          "philosophy",
          "arts",
        ];
        const socialScienceKeywords = [
          "social science",
          "history",
          "geography",
          "economics",
          "political science",
          "psychology",
          "sociology",
          "home science",
        ];
        const commerceKeywords = ["commerce", "accounts", "b.com", "finance"];
        const scienceKeywords = [
          "science",
          "physics",
          "chemistry",
          "maths",
          "biology",
          "botany",
          "zoology",
        ];
        const ugSyllabusKeywords = [
          "ug syllabus",
          "ug syllabuses",
          "undergraduate syllabus",
        ];
        const pgSyllabusKeywords = [
          "pg syllabus",
          "pg syllabuses",
          "postgraduate syllabus",
          "master syllabus",
          "m.sc. syllabus",
          "m.a. syllabus",
          "m.com. syllabus",
          "mca syllabus",
          "m.sc. it syllabus",
        ];

        const isUgSyllabusQuery = ugSyllabusKeywords.some((keyword) =>
          message.includes(keyword)
        );
        const isPgSyllabusQuery = pgSyllabusKeywords.some((keyword) =>
          message.includes(keyword)
        );
        const isVocationalQuery = vocationalKeywords.some((keyword) =>
          message.includes(keyword)
        );
        const isHumanitiesQuery = humanitiesKeywords.some((keyword) =>
          message.includes(keyword)
        );
        const isSocialScienceQuery = socialScienceKeywords.some((keyword) =>
          message.includes(keyword)
        );
        const isCommerceQuery = commerceKeywords.some((keyword) =>
          message.includes(keyword)
        );
        const isScienceQuery = scienceKeywords.some((keyword) =>
          message.includes(keyword)
        );

        // Tier 3: Individual course details
        if (isUgSyllabusQuery) {
          handleUgSyllabusQuery();
          botResponseText = null;
        } else if (isPgSyllabusQuery) {
          handlePgSyllabusQuery();
          botResponseText = null;
        } else if (message.includes("bba")) {
          botResponseText =
            "BBA (Bachelor of Business Administration) ke baare mein jaankari:\n\n" +
            "- **Eligibility:** 10+2 (kisi bhi stream se) minimum 50% marks ke saath.\n" +
            "- **Duration:** Course 3 saal ka hai.\n" +
            "- **Admission:** Admission merit ke basis par hota hai ya college ke selection process se. Commerce background students ko preference mil sakti hai.\n" +
            "- **Syllabus:** <a href='https://magadhmahilacollege.org/wp-content/uploads/2022/04/BBA-cbcs-syllabus-.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>BBA (Bachelor of Business Administration) Syllabus</a>";
        } else if (message.includes("bca")) {
          botResponseText =
            "BCA (Bachelor of Computer Applications) ke baare mein jaankari:\n\n" +
            "- **Course Availability:** Kisan College mein BCA course available hai.\n" +
            "- **Faculty:** Is department mein do faculty members hain: Anil Kumar Choudhary aur Afzal Ahmad.\n" +
            "Zyada details ke liye college ke office se contact karein. \n" +
            "- **Syllabus:** <a href='https://www.ibcpatna.in/BCA_Syllabus.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>BCA (Bachelor of Computer Applications) Syllabus</a>";
        } else if (message.includes("bsc") || message.includes("b.sc")) {
          botResponseText =
            "BSc.it (Bachelor of Science and Informational Technology) ke baare mein jaankari:\n\n" +
            "- **Eligibility:** 10+2 (kisi bhi stream se) minimum 50% marks ke saath.\n" +
            "- **Duration:** Course 3 saal ka hai.\n" +
            "- **Admission:** Admission merit ke basis par hota hai ya college ke selection process se. Science background students ko preference mil sakti hai.\n" +
            "- **Course Availability:** Kisan College mein BSc.it course available hai.\n" +
            "- **Faculty:** Is department mein do faculty members hain: Anil Kumar Choudhary aur Afzal Ahmad.\n" +
            "- **Syllabus:** <a href='https://drive.google.com/file/d/1gQRjbq-QhVVKXY9RKsUnPApNL3bS49uo/view?usp=sharing' target='_blank' style='color:#3b82f6; text-decoration: underline;'>BSc.it (Bachelor of Science and Informational Technology) Syllabus</a>";
        } else if (message.includes("b.lis") || message.includes("blis")) {
          botResponseText =
            "B.Lis (Bachelor of Library Science) ke baare mein jaankari:\n\n" +
            "- **Faculty:** BLIS course ke liye faculty members hain: Kumari Jaya, Archna Kumari, aur Sweta Kumari.\n" +
            "Course ke curriculum ke baare mein adhik jaankari ke liye college se sampark karein.\n" +
            "- **Syllabus:** <a href='https://drive.google.com/file/d/1xtQQ3siqtDOAVwvk-wJ5NrcilHDVeIU8/view?usp=sharing' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.LIS (Bachelor of Library Science) Syllabus</a>";
        } else if (message.includes("physics")) {
          botResponseText =
            "Physics department ke baare mein jaankari:\n\n" +
            "- **Faculty:** No availability in this department.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/FYUG-Physics_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Physics Syllabus</a>";
        } else if (message.includes("chemistry")) {
          botResponseText =
            "Chemistry department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Awadesh Kumar Dwivedi (Assistant Professor), Dr. Chandana Kumari (Assistant Professor), Dr. Gyandshwar Rao (Assistant Professor), Dr. Ramawadesh Kumar (Assistant Professor), Dr. Piyush Panini (Assistant Professor) is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-CHEM_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.Sc. Chemistry (4 Years Course) Syllabus</a>";
        } else if (message.includes("mathematics") || message.includes("maths") || message.includes("math") || message.includes("b.sc math")) {
          botResponseText =
            "Mathematics department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Not Availability \n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-MAT_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.Sc. Mathematics (4 Years Course) Syllabus</a>";
        } else if (message.includes("zoology")) {
          botResponseText =
            "Zoology department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Sudhir Ranjan (Associate Professor), is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-ZOO_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.Sc. Zoology (4 Years Course) Syllabus</a>";
        } else if (message.includes("botany")) {
          botResponseText =
            "Botany department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Fatma Zohra khatoon (Adhoc/Part Time Teacher) is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-BOT_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.Sc. Botany (4 Years Course) Syllabus</a>";
        } else if (message.includes("english")) {
          botResponseText =
            "English department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Satyendra Kumar Sinha, Associate Professor, aur Dr. Pramod Kumar Yadav, Assistant Professor, is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://ppup.ac.in/download/UG%20SYLLABUS-%20English.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.A. English (4 Years Course) Syllabus</a>";
        } else if (message.includes("hindi")) {
          botResponseText =
            "Hindi department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Baby Kumari, Assistant Professor, is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/FYUG-Hindi_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.A. Hindi (4 Years Course) Syllabus</a>";
        } else if (message.includes("urdu")) {
          botResponseText =
            "Urdu department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Sharaf Alam Shamsi, Adhoc/Part Time Teacher, is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-%20Urdu_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.A. Urdu (4 Years Course) Syllabus</a>";
        } else if (message.includes("philosophy")) {
          botResponseText =
            "Philosophy department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Kushaldeo Prasad Singh, Assistant Professor, is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/FYUG-Philosophy_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.A. Philosophy (4 Years Course) Syllabus</a>";
        } else if (message.includes("pali")) {
          botResponseText =
            "Pali department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Priyanka Kumari, Assistant Professor, is department ke faculty members hain.\n" +
            "- **Syllabus:** <a href='https://kisancollege.ac.in/images/ug/UG%20SYLLABUS-%20Pali_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>B.A. Pali (4 Years Course) Syllabus</a>";
        } else if (message.includes("history")) {
          botResponseText =
            "History department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Ravi Kumar, Assistant Professor (Guest Faculty), is department ke faculty members hain.\n\n" +
            "**SYLLABUS:** B.A. HISTORY (4 Years Course)\n" +
            "<a href='https://kisancollege.ac.in/images/ug/FYUG-History_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a>";
        } else if (message.includes("geography")) {
          botResponseText =
            "Geography department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Anoop Kumar Singh, Associate Professor, is department ke faculty members hain.\n" +
            "**SYLLABUS:** B.A. GEOGRAPHY (4 Years Course)\n" +
            "<a href='https://kisancollege.ac.in/images/ug/FYUG-Georaphy_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a>";
        } else if (
          message.includes("a.i & a.s") ||
          message.includes("anthro") ||
          message.includes("archaeo")
        ) {
          botResponseText =
            "A.I & A.S (Anthropology and Archaeology) department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Baljeet Bihari, Assistant Professor (Guest Faculty), aur Dr. Sanjeev Kumar, Assistant Professor (Guest Faculty), is department ke faculty members hain. \n" +
            "**SYLLABUS:** B.A. A.I & A.S (4 Years Course)\n" +
            "<a href='https://kisancollege.ac.in/images/ug/FYUG-AI-and-AS_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a>";
        } else if (message.includes("economics")) {
          botResponseText =
            "Economics department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Prof. (Dr.) Ravindra Nath Singh, Professor, aur Dr. Jawahar Lal Prasad Mandal, Assistant Professor, is department ke faculty members hain. \n" +
            "**SYLLABUS:** B.A. ECONOMICS (4 Years Course)\n" +
            "<a href='https://kisancollege.ac.in/images/ug/Economics_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a>";
        } else if (message.includes("political science") || message.includes("political") || message.includes("polity")) {
          botResponseText =
            "Political Science department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Anand Shankar Samdarshi, Assistant Professor, Dr. Anuj Kumar Singh, Assistant Professor, aur Dr. Pravin Kumar Singh, Assistant Professor (Guest Faculty), is department ke faculty members hain. \n " +
            "**SYLLABUS:** B.A. POLITICAL SCIENCE (4 Years Course)\n" +
            "<a href='https://kisancollege.ac.in/images/ug/FYUG-Political-Sc_compressed.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a>";
        } else if (message.includes("home science")) {
          botResponseText =
            "Home Science department ke baare mein jaankari:\n\n" +
            "Is course ke baare mein koi jankari uplabdh nahi hai.";
        } else if (message.includes("psychology")) {
          botResponseText =
            "Psychology department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Vijay Kumar Yadavendu, Associate Professor, aur Dr. Anil Kumar Sinha, Assistant Professor, is department ke faculty members hain. \n" +
            "**SYLLABUS:** B.A. PSYCHOLOGY (4 Years Course)\n" +
            "<a href='https://ppup.ac.in/download/public_html/download/UG-PG-Syllabus/Phychology%20-%20Copy%201.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a>";
        } else if (message.includes("sociology")) {
          botResponseText =
            "Sociology department ke baare mein jaankari:\n\n" +
            "- **Faculty:** Dr. Vijay Kumar Yadavendu, Assistant Professor, is department ke faculty members hain.\n" +
            "**SYLLABUS:** B.A. SOCIOLOGY (4 Years Course)\n" +
            "<a href='https://ppup.ac.in/download/syllabus/FYUG-Sociology.pdf' target='_blank' style='color:#3b82f6; text-decoration: underline;'>Click here for Syllabus</a>";
        } else if (isVocationalQuery) {
          botResponseText =
            "Vocational courses are as follows:\n\n" +
            "1. BBA (Bachelor of Business Administration)\n" +
            "2. BCA (Bachelor of Computer Applications)\n" +
            "3. BSc. (IT) (Bachelor of Science in Information Technology)\n" +
            "4. B.Lis (Bachelor of Library Science)\n\n" +
            "Which course would you like to know more about?";
        } else if (isHumanitiesQuery) {
          botResponseText =
            "Humanities department mein yeh courses available hain:\n\n" +
            "1. English\n" +
            "2. Hindi\n" +
            "3. Pali\n" +
            "4. Urdu\n" +
            "5. Philosophy\n\n" +
            "Aap kis course ke baare mein jaanna chahte hain?";
        } else if (isSocialScienceQuery) {
          botResponseText =
            "Social Science department mein yeh courses available hain:\n\n" +
            "1. History\n" +
            "2. Geography\n" +
            "3. A.I & A.S\n" +
            "4. Economics\n" +
            "5. Political Science\n" +
            "6. Home Science\n" +
            "7. Psychology\n" +
            "8. Sociology\n\n" +
            "Aap kis course ke baare mein jaanna chahte hain?";
        } else if (isCommerceQuery) {
          botResponseText =
            "Commerce department mein Accounts, Finance, aur Banking ke courses available hain. Aap kis subject ke baare mein jaanna chahte hain?";
        } else if (isScienceQuery) {
          botResponseText =
            "Science department mein \n 1. Physics\n 2. Chemistry\n 3. Mathematics\n 4. Biology\n \n Please choose an option or type your query to know more.";
        } else if (isDepartmentQuery) {
          botResponseText =
            "Our college offers the following departments and courses:\n\n" +
            "1. Commerce Department\n" +
            "2. Humanities\n" +
            "3. Vocational Courses\n" +
            "4. Science\n" +
            "5. Social Science\n\n" +
            "Please choose an option or type your query to know more.";
        } else {
          // Default AI response for any other query
          try {
            const response = await fetch("/ask", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ query: message }),
            });

            const data = await response.json();
            botResponseText = data.response.text;
            coords = data.response.coords;
          } catch (error) {
            console.error("Error fetching AI response:", error);
            botResponseText =
              "Maaf kijiye, AI service se jawab lene mein ek error aa gaya hai.";
          }
        }

        messagesContainer.removeChild(typingMessage);
        if (botResponseText) {
          messagesContainer.appendChild(createBotMessage(botResponseText));
        }

        if (coords) {
          showMap(coords);
        }

        isTyping = false;
        sendButton.disabled = false;
        updateSendButton();
        scrollToBottom();
      }

      // --- Map Functions ---
      function hideMap() {
        const mapContainer = document.getElementById("map-container");
        mapContainer.style.display = "none";
        if (mapInstance) {
          mapInstance.remove();
          mapInstance = null;
        }
      }

      function showMap(destinationCoords) {
        mapContainer = document.getElementById("map-container");
        mapContainer.style.display = "block";

        if (mapInstance) {
          mapInstance.remove();
        }

        mapInstance = L.map("map-container").setView(
          [destinationCoords.lat, destinationCoords.lng],
          15
        );

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(mapInstance);

        L.marker([destinationCoords.lat, destinationCoords.lng])
          .addTo(mapInstance)
          .bindPopup("Destination")
          .openPopup();

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const userCoords = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              L.marker([userCoords.lat, userCoords.lng])
                .addTo(mapInstance)
                .bindPopup("You are here.");

              const bounds = L.latLngBounds(
                [userCoords.lat, userCoords.lng],
                [destinationCoords.lat, destinationCoords.lng]
              );
              mapInstance.fitBounds(bounds, { padding: [50, 50] });

              L.polyline(
                [
                  [userCoords.lat, userCoords.lng],
                  [destinationCoords.lat, destinationCoords.lng],
                ],
                { color: "#3b82f6", weight: 4 }
              ).addTo(mapInstance);
            },
            () => {
              console.warn("Geolocation access denied.");
            }
          );
        }
      }

      // --- Image and Voice Input Logic ---
      function clearImagePreview() {
        selectedImage = null;
        selectedImageData = null;
        const preview = document.getElementById("imagePreview");
        if (preview) {
          preview.remove();
        }
      }

      function showImagePreview(file, dataUrl) {
        clearImagePreview();
        selectedImage = file;
        selectedImageData = dataUrl;

        const previewContainer = document.createElement("div");
        previewContainer.id = "imagePreview";
        previewContainer.style.cssText = `
                position: relative;
                display: inline-block;
                margin-right: 8px;
                margin-bottom: 8px;
            `;

        const previewImg = document.createElement("img");
        previewImg.src = dataUrl;
        previewImg.style.cssText = `
                width: 60px;
                height: 60px;
                object-fit: cover;
                border-radius: 8px;
                border: 2px solid var(--border-color);
            `;

        const removeBtn = document.createElement("button");
        removeBtn.innerHTML = "Ã—";
        removeBtn.style.cssText = `
                position: absolute;
                top: -8px;
                right: -8px;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: #ef4444;
                color: white;
                border: none;
                cursor: pointer;
                font-size: 14px;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
                line-height: 1;
            `;

        removeBtn.onclick = clearImagePreview;
        previewContainer.appendChild(previewImg);
        previewContainer.appendChild(removeBtn);

        const inputContainer = document.querySelector(".p-4.input-area .flex");
        inputContainer.insertBefore(
          previewContainer,
          inputContainer.querySelector(".flex-1")
        );
        updateSendButton();
      }

      function updateSendButton() {
        const hasText = messageInput.value.trim().length > 0;
        const hasImage = selectedImage !== null;
        sendButton.disabled = (!hasText && !hasImage) || isTyping;
      }

      function toggleMicrophone() {
        if (!recognition) {
          alert(
            "Speech recognition is not supported in this browser. Please use a modern browser like Chrome or Edge."
          );
          return;
        }

        isRecording = !isRecording;
        microphoneButton.classList.toggle("active", isRecording);
        microphoneButton.title = isRecording
          ? "Stop recording"
          : "Voice message";

        if (isRecording) {
          recognition.start();
          messagesContainer.appendChild(createBotMessage("Listening...", true));
          scrollToBottom();
        } else {
          recognition.stop();
        }
      }

      function handleCamera() {
        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*";
        fileInput.setAttribute("capture", "environment"); // Opens back camera on mobile
        fileInput.onchange = (event) => {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => showImagePreview(file, e.target.result);
            reader.readAsDataURL(file);
          }
        };
        fileInput.click();
      }

      // --- Event Listeners and Initial Setup ---
      sendButton.addEventListener("click", sendMessage);
      microphoneButton.addEventListener("click", toggleMicrophone);
      cameraButton.addEventListener("click", handleCamera);
      themeToggle.addEventListener("click", toggleTheme);

      messageInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      messageInput.addEventListener("input", updateSendButton);

      // Speech Recognition setup
      if (
        "webkitSpeechRecognition" in window ||
        "SpeechRecognition" in window
      ) {
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = "en-US";

        recognition.onresult = (event) => {
          const transcript =
            event.results[event.results.length - 1][0].transcript;
          messageInput.value = transcript;
          isRecording = false;
          microphoneButton.classList.remove("active");
          messagesContainer.removeChild(messagesContainer.lastChild); // Remove "Listening..."
          sendMessage();
        };

        recognition.onerror = (event) => {
          console.error("Speech recognition error:", event.error);
          isRecording = false;
          microphoneButton.classList.remove("active");
          messagesContainer.removeChild(messagesContainer.lastChild);
          alert("An error occurred with speech recognition: " + event.error);
        };

        recognition.onend = () => {
          // Keep the "Listening..." message if it's not a final result
          if (isRecording) {
            recognition.start();
          }
        };
      }

      // Initial state setup
      sendButton.disabled = true;
      updateSendButton();
      loadInitialTheme();
      scrollToBottom();

      window.addEventListener("resize", scrollToBottom);
    </script>
  </body>
</html>